/*! LineGraph 2014-05-12 */
"use strict";angular.module("LineGraph",["ui.router","LineGraph.Api","Charts","Underscore"]).config(["$stateProvider","$urlRouterProvider","$httpProvider","campaignsProvider",function(a,b,c,d){d.setWebApiUrl("http://localhost:8889"),c.defaults.useXDomain=!0,b.otherwise("/campaigns"),a.state("campaigns",{url:"/campaigns",templateUrl:"/app/templates/campaigns.html",controller:"LineGraph.CampaignsController"})}]).controller("LineGraph.App",["$scope",function(){}]),angular.module("LineGraph.Api",[]).config(["$provide",function(a){function b(a,b){this.$http=a,this.baseUrl=b,this.get=function(){return this.$http.get(this.baseUrl+"/campaigns.json").then(function(a){return a.data})}}a.provider("campaigns",function(){var a;this.setWebApiUrl=function(b){a=b},this.$get=["$http",function(c){return new b(c,a)}]})}]),angular.module("Charts").factory("Highcharts",function(){return Highcharts}).directive("highChart",["Highcharts","$parse",function(a,b){return{replace:!0,restrict:"EAC",scope:!1,link:function(c,d,e){function f(b){g&&g.destroy();var c={};angular.extend(c,b),g=new a.Chart({chart:{type:c.type,renderTo:d[0]},title:{text:c.title},subtitle:{text:c.subtitle},series:c.series||[],xAxis:c.xAxis,yAxis:c.yAxis})}var g;c.$watch(function(){return b(e.config)(c)},function(a){a&&(f(a),g.redraw())},!0),c.$on("$destroy",function(){g&&g.destroy(),d.remove()})}}}]),angular.module("Charts",[]),angular.module("LineGraph").constant("campaign",{DailyUniqueVisitors:"dailyUniqueVisitors",DailySignups:"dailySignups"}),angular.module("LineGraph").controller("LineGraph.CampaignsController",["$scope","campaigns","campaign",function(a,b,c){angular.extend(a,{model:{mode:c.DailyUniqueVisitors}}),b.get().then(function(b){a.model.campaigns=b})}]),angular.module("LineGraph").directive("campaigns",["campaignsConverter",function(a){return{replace:!0,restrict:"E",template:'<high-chart config="chartData.config"></high-chart>',scope:{data:"=",mode:"=?"},link:function(b){function c(){if(b.data&&b.mode){var c=a(b.data,b.mode);angular.extend(b,{chartData:{config:{type:"area",title:"Campaigns",series:c.series,xAxis:c.xAxis}}})}}b.$watch("mode",function(){c()}),b.$watch("data",function(){c()})}}}]),angular.module("LineGraph").factory("campaignsConverter",["_",function(a){function b(b,c){function d(a){return{name:String.prototype.concat(a.month,"/",a.day,"/",a.year),date:+new Date(a.year,a.month,a.day),year:a.year,month:a.month,day:a.day}}var e="All Guests",f={series:[],xAxis:{categories:[]}};this.data_=b,this.mode_=c,this.createSeriesItem=function(){a.each(this.data_.layer.campaigns.item,function(a){f.series.push({id:a.id,name:a.name||e,data:[]})})},this.createSeriesDataItem=function(){a.each(this.data_.layer.campaigns.item,function(b){var c=a.find(f.series,function(a){return a.id===b.id}),d=b[this.mode_].item;a.each(f.xAxis.categories,function(b){var e=a.find(d,function(a){return a.year===b.year&&a.month===b.month&&a.day===b.day});c.data.push(e?parseInt(e.total,10):0)},this)},this)},this.createCategoriesItem=function(){a.each(this.data_.layer.campaigns.item,function(b){a.each(b[this.mode_].item,function(b){var c=d(b),e=a.find(f.xAxis.categories,function(a){return a.date===c.date});e||f.xAxis.categories.push(c)})},this),f.xAxis.categories=a.sortBy(f.xAxis.categories,function(a){return a.date})},this.cleanConstructedObject=function(){f.xAxis.categories=a.map(f.xAxis.categories,function(a){return a.name})},this.getConstructed=function(){return f}}function c(a){this.builder_=a,this.construct=function(){return this.builder_.createSeriesItem(),this.builder_.createCategoriesItem(),this.builder_.createSeriesDataItem(),this.builder_.cleanConstructedObject(),this.builder_.getConstructed()}}function d(a,d){var e=new b(a,d),f=new c(e);return f.construct(),e.getConstructed()}return function(a,b){return d(a,b)}}]),angular.module("Underscore",[]).factory("_",["$window",function(a){return a._}]);